<div class="calculadora-container">
  <h1 class="calculadora-titulo">Calculadora Reactiva</h1>

  <!-- Opciones principales -->
  <div class="opciones-container">
    <h2>Selecciona una opción principal:</h2>
    <div class="opciones-list">
      <button
        *ngFor="let opcion of opcionesPrincipales"
        (click)="seleccionarOpcion(opcion)"
        [class.active]="opcion === opcionSeleccionada"
      >
        {{ opcion }}
      </button>
    </div>
  </div>

  <!-- Subopciones -->
  <div class="opciones-container" *ngIf="opcionSeleccionada">
    <h2>Selecciona una subopción:</h2>
    <div class="opciones-list">
      <button
        *ngFor="let subopcion of (opcionSeleccionada ? subopciones[opcionSeleccionada] : [])"
        (click)="seleccionarSubopcion(subopcion)"
        [class.active]="subopcion === subopcionSeleccionada"
      >
        {{ subopcion }}
      </button>
    </div>
  </div>

  <!-- Opciones adicionales (Subsubopciones) -->
  <div class="opciones-container" *ngIf="subopcionSeleccionada">
    <h2>Selecciona una opción adicional:</h2>
    <div class="opciones-list">
      <!-- Si es Sistemas monofásicos o trifásicos, mostramos las fórmulas de las ecuaciones personalizadas -->
      <ng-container *ngIf="opcionSeleccionada === 'Sistemas monofásicos' || opcionSeleccionada === 'Sistemas trifásicos'; else otros">
        <button
          *ngFor="let item of (opcionSeleccionada === 'Sistemas monofásicos'
                                ? monofasicoEquations[subopcionSeleccionada!]
                                : trifasicoEquations[subopcionSeleccionada!]); let i = index"
          (click)="seleccionarSubsubopcion(i)"
          [class.active]="selectedEquation && selectedEquation.formula === item.formula"
        >
          {{ item.formula }}
        </button>
      </ng-container>
      <!-- Para los otros grupos se usa la estructura original (arreglo de strings) -->
      <ng-template #otros>
        <button
          *ngFor="let item of (opcionSeleccionada ? subsubopciones[opcionSeleccionada][subopcionSeleccionada!] : [])"
          (click)="seleccionarSubsubopcion(item)"
          [class.active]="subsubopcionSeleccionada === item"
        >
          {{ item }}
        </button>
      </ng-template>
    </div>
  </div>

  <!-- Imagen relacionada a la opción final -->
  <div class="imagen-container" *ngIf="(opcionSeleccionada === 'Sistemas monofásicos' || opcionSeleccionada === 'Sistemas trifásicos') ? selectedEquation : subsubopcionSeleccionada">
    <img
      [src]="
        (opcionSeleccionada === 'Sistemas monofásicos' || opcionSeleccionada === 'Sistemas trifásicos')
          ? getImagePath(selectedEquation?.formula || '')
          : getImagePath(subsubopcionSeleccionada || '')
      "
      [alt]="
        (opcionSeleccionada === 'Sistemas monofásicos' || opcionSeleccionada === 'Sistemas trifásicos')
          ? selectedEquation?.formula
          : subsubopcionSeleccionada
      "
      class="imagen-responsive"
    />
  </div>

  <!-- Formulario dinámico para Sistemas monofásicos y trifásicos -->
  <div class="formulario-container" *ngIf="(opcionSeleccionada === 'Sistemas monofásicos' || opcionSeleccionada === 'Sistemas trifásicos') && selectedEquation">
    <h2>Formulario para {{ selectedEquation.formula }}</h2>
    <form (ngSubmit)="calcular()">
      <!-- Se generan los inputs dinámicamente usando los nombres de las variables -->
      <div class="form-group" *ngFor="let variable of monofasicoVariableLabels">
        <label [for]="variable">{{ variable }}:</label>
        <input
          type="number"
          [id]="variable"
          [(ngModel)]="formulario[variable]"
          [name]="variable"
          required
        />
      </div>
      <button type="submit">Calcular</button>
    </form>
  </div>

  <!-- Formulario genérico para otros casos -->
  <div class="formulario-container" *ngIf="opcionSeleccionada !== 'Sistemas monofásicos' && opcionSeleccionada !== 'Sistemas trifásicos' && subsubopcionSeleccionada">
    <h2>Formulario para {{ subsubopcionSeleccionada }}</h2>
    <form (ngSubmit)="calcular()">
      <div class="form-group">
        <label for="input1">Input 1:</label>
        <input type="number" id="input1" [(ngModel)]="formulario['input1']" name="input1" required>
      </div>
      <div class="form-group">
        <label for="input2">Input 2:</label>
        <input type="number" id="input2" [(ngModel)]="formulario['input2']" name="input2" required>
      </div>
      <div class="form-group">
        <label for="input3">Input 3:</label>
        <input type="number" id="input3" [(ngModel)]="formulario['input3']" name="input3" required>
      </div>
      <button type="submit">Calcular</button>
    </form>
  </div>

  <!-- Resultado -->
  <div class="resultado-container" *ngIf="resultado !== null">
    <h2>Resultado</h2>
    <p>{{ resultado }} Watios</p>
  </div>
</div>
